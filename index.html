<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavelength Online Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: -apple-system, sans-serif; background-color: #1a1a1a; color: #fff; text-align: center; padding: 20px; user-select: none; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 15px; max-width: 500px; margin: 0 auto; border-top: 5px solid #555; }
        .btn { background-color: #555; border: none; color: white; padding: 15px 0; width: 100%; border-radius: 50px; font-size: 16px; margin: 5px 0; cursor: pointer; font-weight: bold; transition: opacity 0.3s; }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-green { background-color: #4CAF50; }
        .btn-blue { background-color: #2196F3; }
        .btn-red { background-color: #F44336; }
        .hidden { display: none !important; }
        .big-number { font-size: 60px; font-weight: bold; color: #ffeb3b; margin: 20px 0; }
        
        input[type=range] { width: 100%; margin: 30px 0; cursor: pointer; }

        /* ãƒãƒ¼ãƒ é¸æŠãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ */
        .lobby-container { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 20px; }
        .team-column { flex: 1; background: #333; padding: 10px; border-radius: 8px; border-top: 3px solid #777; }
        .team-header { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .player-list { min-height: 50px; font-size: 13px; text-align: left; margin-bottom: 10px; }
        .p-item { padding: 2px 5px; border-radius: 4px; margin-bottom: 2px; background: rgba(255,255,255,0.1); }
        .p-me { border: 1px solid #fff; font-weight: bold; }
        .p-psychic::after { content: " â˜…è¦ª"; color: #ff9800; font-size: 11px; }

        /* ç¾åœ¨ã®ãƒãƒ¼ãƒ è¡¨ç¤ºãƒãƒƒã‚¸ */
        .my-team-badge { background: #555; padding: 5px 15px; border-radius: 20px; font-size: 12px; display: inline-block; margin-bottom: 10px; }

        /* çµæœãƒãƒ¼ */
        .result-viz-container { position: relative; width: 100%; height: 60px; background-color: #444; border-radius: 8px; margin: 15px 0; overflow: hidden; }
        .zone { position: absolute; height: 100%; top: 0; opacity: 0.8; }
        .zone-2 { background-color: #4fc3f7; } .zone-3 { background-color: #ffd740; } .zone-4 { background-color: #ff6e40; }
        .guess-pin { position: absolute; top: 0; width: 4px; height: 100%; background-color: #fff; z-index: 10; box-shadow: 0 0 4px #000; transition: left 0.2s; }
        .target-pin { position: absolute; top: 0; width: 2px; height: 100%; background-color: #ffeb3b; z-index: 5; opacity: 0.5; border-left: 1px dashed #000; }
    </style>
</head>
<body>

    <div id="screen-login" class="card">
        <h1>Wavelength Online</h1>
        <div style="margin-bottom: 20px;">
            <p>åå‰ã‚’å…¥åŠ›</p>
            <input type="text" id="input-name" placeholder="ã‚ãªãŸã®åå‰" style="padding:10px; font-size:16px; width:80%; text-align:center; margin-bottom:10px;">
            <p>åˆè¨€è‘‰ (éƒ¨å±‹ID)</p>
            <input type="text" id="input-room" placeholder="ä¾‹: 0119" style="padding:10px; font-size:16px; width:80%; text-align:center;">
        </div>
        <button class="btn btn-green" onclick="connectToRoom()">ãƒ­ãƒ“ãƒ¼ã¸å…¥å®¤</button>
    </div>

    <div id="screen-game" class="card hidden">
        <div style="display:flex; justify-content:space-between; font-size:12px; color:#aaa; margin-bottom:5px;">
            <span>Room: <span id="display-room-id" style="color:#fff;"></span></span>
            <span id="connection-status">æ¥ç¶šä¸­...</span>
        </div>

        <div id="my-status-area">
            <span class="my-team-badge">è¦³æˆ¦ä¸­ (ãƒãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„)</span>
        </div>

        <div class="lobby-container">
            <div class="team-column" style="border-top-color: #2196F3;">
                <div class="team-header">TEAM A (<span id="count-a">0</span>)</div>
                <div id="list-a" class="player-list"></div>
                <button class="btn btn-blue" style="font-size:12px;" onclick="joinTeam('A')">Aã«å‚åŠ </button>
                <div style="font-size:20px; font-weight:bold; margin-top:5px;" id="score-a">0</div>
            </div>
            <div class="team-column" style="border-top-color: #F44336;">
                <div class="team-header">TEAM B (<span id="count-b">0</span>)</div>
                <div id="list-b" class="player-list"></div>
                <button class="btn btn-red" style="font-size:12px;" onclick="joinTeam('B')">Bã«å‚åŠ </button>
                <div style="font-size:20px; font-weight:bold; margin-top:5px;" id="score-b">0</div>
            </div>
        </div>

        <p id="status-text" style="font-size:18px; font-weight:bold; color:#ffeb3b; min-height: 27px; margin: 10px 0;">
            ãƒãƒ¼ãƒ ã‚’é¸ã‚“ã§ãã ã•ã„
        </p>

        <div id="phase-waiting" class="hidden">
            <button class="btn btn-green" onclick="startNewRound(true)">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>

        <div id="phase-psychic" class="hidden">
            <div id="view-psychic-active" class="hidden">
                <p style="background:#ff9800; color:#000; display:inline-block; padding:2px 8px; border-radius:4px; font-size:12px;">ã‚ãªãŸã¯è¦ªã§ã™</p>
                <p>æ•°å€¤ã‚’ç¢ºèªã—ã¦ãƒ’ãƒ³ãƒˆã‚’å‡ºãã†</p>
                <div class="big-number" id="secret-target">??</div>
                <button class="btn" onclick="nextPhase('GUESS')">ãƒ’ãƒ³ãƒˆã‚’å‡ºã—ãŸ (å›ç­”ã¸)</button>
            </div>
            <div id="view-psychic-wait">
                <div class="big-number" style="font-size:40px; color:#555;">SECRET</div>
            </div>
        </div>

        <div id="phase-guess" class="hidden">
            <div id="slider-msg" style="font-size:12px; color:#aaa;"></div>
            <div class="big-number" id="guess-display">50</div>
            <input type="range" id="slider" min="0" max="100" value="50" oninput="onSliderChange(this.value)" onchange="onSliderChange(this.value)">
            <button id="btn-submit-guess" class="btn hidden" onclick="nextPhase('COUNTER')">äºˆæƒ³ã‚’ç¢ºå®šã™ã‚‹</button>
        </div>

        <div id="phase-counter" class="hidden">
            <p>æ•µãƒãƒ¼ãƒ ã®ãƒãƒ£ãƒ³ã‚¹ï¼<br>æ­£è§£ã¯äºˆæƒ³(<span id="locked-guess"></span>)ã‚ˆã‚Š...</p>
            <div style="display:flex; justify-content:space-between;">
                <button id="btn-left" class="btn hidden" style="width:48%" onclick="submitCounter('Left')">â¬…ï¸ å·¦</button>
                <button id="btn-right" class="btn hidden" style="width:48%" onclick="submitCounter('Right')">å³ â¡ï¸</button>
            </div>
            <p id="counter-wait-msg" style="font-size:12px; color:#aaa; margin-top:10px;">æ•µãƒãƒ¼ãƒ ã®æ“ä½œå¾…ã¡...</p>
        </div>

        <div id="phase-result" class="hidden">
            <div class="result-viz-container" id="viz-bar"></div>
            <div id="result-details" style="text-align:left; font-size:14px; line-height:1.6;"></div>
            <button class="btn btn-green" onclick="startNewRound()">æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸</button>
        </div>

        <div id="phase-win" class="hidden">
            <h1>WINNER!</h1>
            <div style="font-size:60px;">ğŸ†</div>
            <h2 id="winner-name">TEAM A</h2>
            <button class="btn btn-red" onclick="startNewRound(true)">ãƒªã‚»ãƒƒãƒˆã—ã¦å†æˆ¦</button>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… Firebaseè¨­å®š (ã”è‡ªèº«ã®ã‚‚ã®ã«æ›¸ãæ›ãˆã¦ãã ã•ã„) â˜…â˜…â˜…
        const firebaseConfig = {
            apiKey: "AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxx",
            authDomain: "wavelength-xxxxx.firebaseapp.com",
            databaseURL: "https://wavelength-xxxxx-default-rtdb.firebaseio.com",
            projectId: "wavelength-xxxxx",
            storageBucket: "wavelength-xxxxx.appspot.com",
            messagingSenderId: "00000000000",
            appId: "1:00000000000:web:000000000000"
        };
        // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myId = localStorage.getItem('wl_uid');
        if (!myId) {
            myId = Math.random().toString(36).substring(2, 15);
            localStorage.setItem('wl_uid', myId);
        }

        let myName = "";
        let myTeam = ""; // 'A', 'B', or '' (spectator)
        let roomId = "";
        let gameState = {};
        
        const WIN_SCORE = 10;
        const RANGES = { w4: 2, w3: 5, w2: 8 };
        const TEAM_CONF = { A: {color:"#2196F3", name:"TEAM A"}, B: {color:"#F44336", name:"TEAM B"} };

        // 1. éƒ¨å±‹ã«æ¥ç¶š (ã¾ã ãƒãƒ¼ãƒ ã¯æœªå®š)
        function connectToRoom() {
            const name = document.getElementById('input-name').value;
            const room = document.getElementById('input-room').value;
            if (!name || !room) return alert("åå‰ã¨éƒ¨å±‹IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            myName = name;
            roomId = "wl_room_" + room;
            document.getElementById('display-room-id').innerText = room;
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ² (æœ€åˆã¯ãƒãƒ¼ãƒ æœªå®š = è¦³æˆ¦)
            db.ref(`${roomId}/players/${myId}`).update({
                name: myName,
                online: true
            });
            // åˆ‡æ–­æ™‚ã«ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ãƒ©ã‚°ã‚’æ¶ˆã™è¨­å®š
            db.ref(`${roomId}/players/${myId}/online`).onDisconnect().remove();

            document.getElementById('screen-login').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');

            // DBç›£è¦–é–‹å§‹
            db.ref(roomId).on('value', snapshot => {
                const data = snapshot.val();
                if (data) {
                    gameState = data;
                    renderGame();
                } else {
                    // éƒ¨å±‹ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆï¼ˆåˆå›ï¼‰
                    gameState = { phase: 'WAITING', players: {} };
                    renderGame();
                }
            });
        }

        // ãƒãƒ¼ãƒ ã«å‚åŠ ãƒ»ç§»å‹•
        function joinTeam(team) {
            myTeam = team;
            db.ref(`${roomId}/players/${myId}`).update({
                team: team,
                name: myName
            });
            // UIæ›´æ–°ã¯DBç›£è¦–çµŒç”±ã§è¡Œã‚ã‚Œã‚‹
        }

        // ã‚²ãƒ¼ãƒ é€²è¡Œ: æ–°ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹
        function startNewRound(fullReset = false) {
            let scores = { A: 0, B: 0 };
            let round = 1;
            let nextTeam = 'A';
            const players = gameState.players || {};

            if (!fullReset && gameState.scores) {
                scores = gameState.scores;
                round = gameState.round + 1;
                nextTeam = gameState.currentTeam === 'A' ? 'B' : 'A';
            } else {
                nextTeam = Math.random() < 0.5 ? 'A' : 'B';
            }

            // æ¬¡ã®ãƒãƒ¼ãƒ ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã§è¦ªã‚’é¸ã¶
            // (ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‹ã¤ã€ãã®ãƒãƒ¼ãƒ ã®äººã‹ã‚‰é¸ã¶)
            const teamMembers = Object.keys(players).filter(uid => {
                const p = players[uid];
                return p.team === nextTeam && p.online; // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®äººã ã‘
            });
            
            let psychicId = null;
            if (teamMembers.length > 0) {
                psychicId = teamMembers[Math.floor(Math.random() * teamMembers.length)];
            }

            db.ref(roomId).update({
                phase: 'PSYCHIC',
                currentTeam: nextTeam,
                psychicId: psychicId,
                target: Math.floor(Math.random() * 101),
                guess: 50,
                scores: scores,
                round: round,
                counterGuess: null,
                resultData: null
            });
        }

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œ
        function onSliderChange(val) {
            if (gameState.phase !== 'GUESS') return;
            // æ¨©é™ãƒã‚§ãƒƒã‚¯: è‡ªãƒãƒ¼ãƒ ã®æ‰‹ç•ª ã‹ã¤ è‡ªåˆ†ã¯è¦ªã˜ã‚ƒãªã„
            if (gameState.currentTeam === myTeam && gameState.psychicId !== myId) {
                db.ref(roomId).update({ guess: parseInt(val) });
            }
        }

        function nextPhase(next) {
            // è¦ªæ¨©é™ãƒã‚§ãƒƒã‚¯
            if (next === 'GUESS' && myId !== gameState.psychicId) return;
            // å›ç­”ç¢ºå®šãƒã‚§ãƒƒã‚¯
            if (next === 'COUNTER') {
                 if (myTeam !== gameState.currentTeam || myId === gameState.psychicId) return;
            }
            db.ref(roomId).update({ phase: next });
        }

        function submitCounter(direction) {
            if (myTeam === gameState.currentTeam) return; // æ•µãƒãƒ¼ãƒ ã®ã¿

            const target = gameState.target;
            const guess = gameState.guess;
            const active = gameState.currentTeam;
            const inactive = active === 'A' ? 'B' : 'A';

            let diff = Math.abs(target - guess);
            let finalDiff = Math.min(diff, 100 - diff);

            let activePts = 0;
            if (finalDiff === 0) activePts = 5;
            else if (finalDiff <= RANGES.w4) activePts = 4;
            else if (finalDiff <= RANGES.w3) activePts = 3;
            else if (finalDiff <= RANGES.w2) activePts = 2;

            let inactivePts = 0;
            let resultMsg = "";
            let counterStr = direction === 'Right' ? 'å³' : 'å·¦';

            if (finalDiff === 0) {
                resultMsg = "å®Œå…¨ä¸€è‡´ã®ãŸã‚ãƒœãƒ¼ãƒŠã‚¹ãªã—";
            } else {
                let d = target - guess;
                if (d > 50) d -= 100;
                if (d < -50) d += 100;
                let trueDir = d > 0 ? 'Right' : 'Left';
                
                if (direction === trueDir) {
                    inactivePts = 1;
                    resultMsg = "ãƒãƒ£ãƒ³ã‚¹æˆåŠŸï¼ (+1ç‚¹)";
                    counterStr += " â†’ æ­£è§£ï¼";
                } else {
                    resultMsg = "ãƒãƒ£ãƒ³ã‚¹å¤±æ•—...";
                    counterStr += " â†’ ãƒã‚ºãƒ¬";
                }
            }

            let newScores = { ...gameState.scores };
            newScores[active] += activePts;
            newScores[inactive] += inactivePts;

            db.ref(roomId).update({
                scores: newScores,
                counterGuess: direction,
                resultData: { activePts, inactivePts, finalDiff, msg: resultMsg, counterStr: counterStr },
                phase: (newScores.A >= WIN_SCORE || newScores.B >= WIN_SCORE) ? 'WIN' : 'RESULT'
            });
        }

        // â˜…â˜…â˜… æç”» â˜…â˜…â˜…
        function renderGame() {
            const g = gameState;
            const players = g.players || {};

            // 0. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
            document.getElementById('connection-status').innerText = "é€šä¿¡OK";
            if (!myTeam) {
                document.querySelector('.my-team-badge').innerText = "è¦³æˆ¦ä¸­ (ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ãã ã•ã„)";
                document.querySelector('.my-team-badge').style.background = "#555";
            } else {
                document.querySelector('.my-team-badge').innerText = "ã‚ãªãŸã¯ " + TEAM_CONF[myTeam].name + " ã§ã™";
                document.querySelector('.my-team-badge').style.background = TEAM_CONF[myTeam].color;
            }

            // 1. ãƒ­ãƒ“ãƒ¼ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆï¼‰æ›´æ–°
            const listA = document.getElementById('list-a');
            const listB = document.getElementById('list-b');
            listA.innerHTML = ""; listB.innerHTML = "";
            let countA = 0, countB = 0;

            Object.keys(players).forEach(uid => {
                const p = players[uid];
                if (!p.online) return; // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®äººã¯è¡¨ç¤ºã—ãªã„ç°¡æ˜“å¯¾å¿œ

                const div = document.createElement('div');
                div.className = "p-item" + (uid === myId ? " p-me" : "") + (uid === g.psychicId ? " p-psychic" : "");
                div.innerText = p.name;

                if (p.team === 'A') { listA.appendChild(div); countA++; }
                else if (p.team === 'B') { listB.appendChild(div); countB++; }
                // ãƒãƒ¼ãƒ æœªæ‰€å±ã¯ãƒªã‚¹ãƒˆã«å‡ºã•ãªã„ã‹ã€åˆ¥ã®å ´æ‰€ã«å‡ºã™ï¼ˆä»Šå›ã¯å‰²æ„›ï¼‰
            });
            document.getElementById('count-a').innerText = countA;
            document.getElementById('count-b').innerText = countB;

            // ã‚¹ã‚³ã‚¢
            document.getElementById('score-a').innerText = g.scores ? g.scores.A : 0;
            document.getElementById('score-b').innerText = g.scores ? g.scores.B : 0;

            // 2. ãƒ•ã‚§ãƒ¼ã‚ºåˆ¶å¾¡
            ['waiting', 'psychic', 'guess', 'counter', 'result', 'win'].forEach(id => {
                document.getElementById('phase-' + id).classList.add('hidden');
            });

            // ãƒ•ã‚§ãƒ¼ã‚º: å¾…æ©Ÿ
            if (!g.phase || g.phase === 'WAITING') {
                document.getElementById('status-text').innerText = "ãƒ¡ãƒ³ãƒãƒ¼ãŒé›†ã¾ã£ãŸã‚‰é–‹å§‹ã—ã¦ãã ã•ã„";
                document.getElementById('phase-waiting').classList.remove('hidden');
                return;
            }

            const tmConf = TEAM_CONF[g.currentTeam] || {name:"", color:"#fff"};
            const statusEl = document.getElementById('status-text');
            statusEl.style.color = tmConf.color;

            // å½¹å‰²ãƒ•ãƒ©ã‚°
            const isActiveTeam = (myTeam === g.currentTeam);
            const isPsychic = (myId === g.psychicId);
            const isEnemy = (myTeam && !isActiveTeam);

            // ãƒ•ã‚§ãƒ¼ã‚º: å‡ºé¡Œ
            if (g.phase === 'PSYCHIC') {
                document.getElementById('phase-psychic').classList.remove('hidden');
                const pName = players[g.psychicId] ? players[g.psychicId].name : "è¦ª";
                statusEl.innerText = `${tmConf.name} (${pName}) ã®å‡ºé¡Œ`;
                
                if (isPsychic) {
                    document.getElementById('view-psychic-active').classList.remove('hidden');
                    document.getElementById('view-psychic-wait').classList.add('hidden');
                    document.getElementById('secret-target').innerText = g.target;
                } else {
                    document.getElementById('view-psychic-active').classList.add('hidden');
                    document.getElementById('view-psychic-wait').classList.remove('hidden');
                }
            } 
            // ãƒ•ã‚§ãƒ¼ã‚º: å›ç­”
            else if (g.phase === 'GUESS') {
                document.getElementById('phase-guess').classList.remove('hidden');
                statusEl.innerText = `${tmConf.name} ãŒç›¸è«‡ä¸­...`;
                
                document.getElementById('guess-display').innerText = g.guess;
                const slider = document.getElementById('slider');
                slider.value = g.guess;
                slider.style.accentColor = tmConf.color;

                const submitBtn = document.getElementById('btn-submit-guess');
                const msg = document.getElementById('slider-msg');

                if (isActiveTeam && !isPsychic) {
                    slider.disabled = false;
                    submitBtn.classList.remove('hidden');
                    msg.innerText = "ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦æ±ºå®šã—ã¦ãã ã•ã„";
                } else {
                    slider.disabled = true;
                    submitBtn.classList.add('hidden');
                    msg.innerText = isPsychic ? "è¦ªã¯æ“ä½œã§ãã¾ã›ã‚“" : "ç›¸æ‰‹ãƒãƒ¼ãƒ ãŒæ“ä½œä¸­...";
                }
            }
            // ãƒ•ã‚§ãƒ¼ã‚º: ãƒãƒ£ãƒ³ã‚¹
            else if (g.phase === 'COUNTER') {
                document.getElementById('phase-counter').classList.remove('hidden');
                const enemyConf = TEAM_CONF[g.currentTeam === 'A' ? 'B' : 'A'];
                statusEl.innerText = `${enemyConf.name} ã®ãƒãƒ£ãƒ³ã‚¹ï¼`;
                statusEl.style.color = enemyConf.color;
                document.getElementById('locked-guess').innerText = g.guess;

                if (isEnemy) {
                    document.getElementById('btn-left').classList.remove('hidden');
                    document.getElementById('btn-right').classList.remove('hidden');
                    document.getElementById('counter-wait-msg').classList.add('hidden');
                } else {
                    document.getElementById('btn-left').classList.add('hidden');
                    document.getElementById('btn-right').classList.add('hidden');
                    document.getElementById('counter-wait-msg').classList.remove('hidden');
                }
            }
            // ãƒ•ã‚§ãƒ¼ã‚º: çµæœ
            else if (g.phase === 'RESULT') {
                document.getElementById('phase-result').classList.remove('hidden');
                statusEl.innerText = "çµæœç™ºè¡¨";
                statusEl.style.color = "#fff";
                drawVisualResult(g.target, g.guess, tmConf.color);
                
                const rd = g.resultData || {};
                document.getElementById('result-details').innerHTML = `
                    <p>æ­£è§£: <strong style="color:#ffeb3b">${g.target}</strong> (èª¤å·® ${rd.finalDiff})</p>
                    <p>æ‰‹ç•ª(${tmConf.name}): <strong>+${rd.activePts}ç‚¹</strong></p>
                    <p>ãƒãƒ£ãƒ³ã‚¹: ${rd.counterStr}</p>
                `;
            }
            // ãƒ•ã‚§ãƒ¼ã‚º: å‹åˆ©
            else if (g.phase === 'WIN') {
                document.getElementById('phase-win').classList.remove('hidden');
                statusEl.innerText = "";
                const winner = g.scores.A >= WIN_SCORE ? 'TEAM A' : 'TEAM B';
                document.getElementById('winner-name').innerText = winner;
                document.getElementById('winner-name').style.color = TEAM_CONF[winner.slice(-1)].color;
            }
        }

        // çµæœæç”»
        function drawVisualResult(target, guess, color) {
            const container = document.getElementById('viz-bar');
            container.innerHTML = ''; 
            function createZone(w, cls) {
                let s = target - w, e = target + w;
                drawR(s, e, cls);
                if (s < 0) drawR(100+s, 100, cls);
                if (e > 100) drawR(0, e-100, cls);
            }
            function drawR(l, r, cls) {
                let div = document.createElement('div');
                div.className = 'zone ' + cls;
                div.style.left = Math.max(0,l)+'%'; div.style.width = (Math.min(100,r)-Math.max(0,l))+'%';
                container.appendChild(div);
            }
            createZone(8, 'zone-2'); createZone(5, 'zone-3'); createZone(2, 'zone-4');
            
            let pin = document.createElement('div');
            pin.className = 'guess-pin';
            pin.style.left = guess + '%';
            pin.style.backgroundColor = color;
            container.appendChild(pin);

            let tPin = document.createElement('div');
            tPin.className = 'target-pin';
            tPin.style.left = target + '%';
            container.appendChild(tPin);
        }
    </script>
</body>
</html>
